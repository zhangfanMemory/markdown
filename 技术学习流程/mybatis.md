# mybatis学习
![](/技术学习流程/pic/2023-07-02-18-47-53.png)
1. 第一次发出一个查询 sql，sql 查询结果写入 sqlsession 的一级缓存中，缓存使用的数据结构是一个 map。key：MapperID+offset+limit+Sql+所有的入参
2. 如果两次中间出现 commit 操作
（修改、添加、删除），本 sqlsession 中的一级缓存区域全部清空，下次再去缓存中查询不到所
以要从数据库查询，从数据库查询到再写入缓存。

1. mybatis 的二级缓存是通过 CacheExecutor 实现的。mapper 以命名空间为单位创建缓存数据结构，结构是 map
   1. Mybatis 全局配置中启用二级缓存配置
   2. 在对应的 Mapper.xml 中配置 cache 节点
   3. 在对应的 select 查询节点中添加 useCache=true

问题：同时存在1/2级缓存是怎么运行的
1. 当执行一个查询语句时，MyBatis首先检查一级缓存，看是否有缓存的结果。
2. 如果一级缓存中存在结果，则直接返回缓存的结果。
3. 如果一级缓存中没有结果，则会检查是否配置了二级缓存。
4. 如果配置了二级缓存且查询的结果在二级缓存中存在，则从二级缓存中获取结果，并返回。
5. 如果缓存中没有结果，则执行实际的SQL查询操作，获取数据库的查询结果。
6. 将查询结果存储到一级缓存和二级缓存中，以便下次使用。
7. 
**需要注意的是，对于更新、插入、删除等会修改数据库的操作，MyBatis会清空一级缓存和相关的二级缓存，以保证数据的一致性。**
